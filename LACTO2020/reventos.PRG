*PARAMETERS CDIAS
PUBLIC B
B=CTOD("")
CLOSE DATABASES

CREATE TABLE REVENTOS (ID n(5),NP n(2),FPARTO d(8),FECHA d(8),EVENTO n(2),CEVENTO c(12),STAT c(5),NS n(2),FECHA2 d(8),DIAS n(4),CODE n(1))
CLOSE TABLES

Use REG     IN 1 ALIAS REG
Use CALOR   IN 2
USE GNFERT  IN 3 ALIAS GNF  
USE ABORTOS IN 4 ALIAS ABT

USE REVENTOS IN 5 ALIAS REV EXCLUSIVE
SELECT REV

SELECT REG
SET ORDER TO 2
SCAN
	SELECT REV
	APPEND BLANK
	REPLACE REV.ID WITH REG.ID,REV.NP WITH REG.NP,REV.FPARTO WITH REG.FPAR,REV.FECHA WITH REG.FPAR,REV.EVENTO WITH 1,REV.CEVENTO WITH 'Parto',REV.STAT WITH 'FRESC'
	SELECT REG
ENDSCAN	

*------------
SELECT CALOR
SET ORDER TO 2
SET FILTER TO (CLAVE=3 OR CLAVE=4 OR CLAVE=9) AND FECHA>=DATE()-500 AND NP>0
SCAN
	SELECT REV
	SCAN FOR CALOR.ID=REV.ID 

	IF CALOR.NP=REV.NP
		APPEND BLANK
		REPLACE REV.ID WITH CALOR.ID,REV.NP WITH CALOR.NP,REV.FPARTO WITH CALOR.PARTO,REV.FECHA WITH CALOR.FECHA,REV.EVENTO WITH CALOR.CLAVE,REV.NS WITH CALOR.SER ,REV.FECHA2 WITH CALOR.FECHA2,REV.STAT WITH CALOR.STAT
		REPLACE REV.CEVENTO WITH ICASE(CALOR.CLAVE=2,CALOR.STAT,CALOR.CLAVE=3,'Tratamiento',CALOR.CLAVE=4,'Celo',CALOR.CLAVE=9,'Aborto')
		REPLACE DIAS WITH FECHA-FPARTO
	ENDIF
	ENDSCAN
SELECT CALOR
ENDSCAN

*------------
SELECT GNF
SET FILTER TO (CLAVE=5 OR CLAVE=6) AND FECHA>=DATE()-450 AND SER>0 AND NP>0
SCAN
	SELECT REV
	APPEND BLANK
	REPLACE REV.ID WITH GNF.ID,REV.NP WITH GNF.NP,REV.FPARTO WITH GNF.PARTO,REV.FECHA WITH GNF.FECHA,REV.EVENTO WITH GNF.CLAVE,REV.NS WITH GNF.SER ,REV.FECHA2 WITH GNF.FECHA2,REV.STAT WITH GNF.STAT
	REPLACE REV.CEVENTO WITH ICASE(GNF.CLAVE=5,'Inseminacion',GNF.CLAVE=6,'Dx Gestacion')
	REPLACE REV.DIAS WITH REV.FECHA-REV.FPARTO
SELECT GNF
ENDSCAN

*------------
SELECT ABT
SET FILTER TO NP>0
SCAN
		APPEND BLANK
		REPLACE REV.ID WITH ABT.ID,REV.NP WITH ABT.NP,REV.FPARTO WITH ABT.FPAR,REV.FECHA WITH ABT.FECHA,REV.EVENTO WITH 9,REV.STAT WITH 'ABORT'
		REPLACE REV.CEVENTO WITH 'Aborto'
ENDSCAN

*-------------------	
SELECT REG
SET ORDER TO 2
SCAN
	IF REG.FPSV#B
	SELECT REV
	APPEND BLANK
	REPLACE REV.ID WITH REG.ID,REV.NP WITH REG.NP,REV.FPARTO WITH REG.FPAR,REV.FECHA WITH REG.FPSV,REV.EVENTO WITH 21,REV.CEVENTO WITH 'PSV',REV.STAT WITH REG.STAT
	ENDIF
	
	IF REG.FB2#B
	SELECT REV
	APPEND BLANK
	REPLACE REV.ID WITH REG.ID,REV.NP WITH REG.NP,REV.FPARTO WITH REG.FPAR,REV.FECHA WITH REG.FB2,REV.EVENTO WITH 22,REV.CEVENTO WITH 'BAJA',REV.STAT WITH REG.STAT
	ENDIF
	
	SELECT REG
ENDSCAN	
*------------------
SELECT REV
INDEX ON ID TAG ID
browse
*COPY TO REVENTOS2
*ELSE
*ENDIF
CLOSE TABLES
RETURN
