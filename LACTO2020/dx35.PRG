xYEAR=2010

CREATE TABLE XDX35 (ID n(5),NP n(2),FECHA d(8),STAT c(5),DGES n(3),SER1 n(2),FECHA2 d(8),STAT2 c(5),DIAS n(3),SER2 n(2))

USE c:\lacto2006\lx10\CALOR ORDER 2 IN 1
USE XDX35 IN 2

SELECT CALOR
SCAN 
	IF DGES>30 AND DGES<50 AND YEAR(FECHA)=xYEAR AND STAT="CARGA" 
	SELECT xDX35
	APPEND BLANK
	REPLACE ID WITH CALOR.ID,NP WITH CALOR.NP,FECHA WITH CALOR.FECHA,STAT WITH CALOR.STAT,DGES WITH CALOR.DGES,SER1 WITH CALOR.SER
	ENDIF
ENDSCAN

SELECT xDX35
xxNUEVA=0
xxTOTAL=RECCOUNT()

SCAN 
xID=xDX35.ID

SELECT CALOR
SEEK xID

	SCAN WHILE CALOR.ID=xDX35.ID AND CALOR.CLAVE#9 
		IF CALOR.NP=xDX35.NP AND CALOR.FECHA>xDX35.FECHA
		IF STAT="INSEM"
				?xDX35.ID,xDX35.FECHA,xDX35.STAT,xDX35.SER1,xDX35.DGES
				?ID,FECHA,STAT,SER,DIAS
				xxNUEVA=xxNUEVA+1
				REPLACE XDX35.FECHA2 WITH CALOR.FECHA,XDX35.STAT2 WITH CALOR.STAT,XDX35.SER2 WITH CALOR.SER
				EXIT
			ELSE
			EXIT
			ENDIF
		ENDIF	
	ENDSCAN
	SELECT xDX35
				  	
ENDSCAN

?xxTOTAL
?xxNUEVA
SET FILTER TO fecha2#CTOD("")
BROWSE
CLOSE DATABASES
